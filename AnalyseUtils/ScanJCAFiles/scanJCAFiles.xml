<?xml version="1.0" encoding="windows-1252" ?>
<!--Ant Build file to scan JCA files in a repository and list relvant properties-->
<project xmlns="antlib:org.apache.tools.ant" name="scanJCAFiles" default="all" basedir=".">
  <property name="author" value="Martien van den Akker"/>
  <property name="version" value="1.0"/>
  <property environment="env"/>
  <property file="build.properties"/>
  <taskdef resource="net/sf/antcontrib/antlib.xml">
    <classpath>
      <pathelement location="${ant-contrib.jar}"/>
    </classpath>
  </taskdef>
  <!-- Initialisatie -->
  <target name="clean" description="Clean the temp folder">
    <delete dir="${jcaTempDir}"/>
    <mkdir dir="${jcaTempDir}"/>
  </target>
  <!-- Perform all -->
  <target name="all" description="Scan All SOA applications" depends="clean">
    <echo>FMW_HOME=${fmw.home}.</echo>
    <appendCSV item='Application' first="true"/>
    <appendCSV item='Project name'/>
    <appendCSV item='jcaFile'/>
    <appendCSV item='Adapter-config Name'/>
    <appendCSV item='Adapter Type'/>
    <appendCSV item='Endpoint Type'/>
    <appendCSV item='Connection Factory Location'/>
    <appendCSV item='Endpoint PortType'/>
    <appendCSV item='Endpoint Operation'/>
    <appendCSV item='Class Name'/>
    <!--JMS/AQ -->
    <appendCSV item='DestinationName'/>
    <appendCSV item='QueueName'/>
    <appendCSV item='DeliveryMode'/>
    <appendCSV item='TimeToLive'/>
    <appendCSV item='UseMessageListener'/>
    <appendCSV item='MessageSelector'/>
    <appendCSV item='PayloadType'/>
    <appendCSV item='ObjectFieldName'/>
    <appendCSV item='PayloadHeaderRequired'/>
    <appendCSV item='RecipientList'/>
    <appendCSV item='Consumer'/>
    <!--File/FTP -->
    <appendCSV item='ChunkSize'/>
    <appendCSV item='NumberMessages'/>
    <appendCSV item='Append'/>
    <appendCSV item='FileName'/>
    <appendCSV item='FileType'/>
    <appendCSV item='FileNamingConvention'/>
    <appendCSV item='LogicalDirectory'/>
    <appendCSV item='LogicalArchiveDirectory'/>
    <appendCSV item='UseRemoteErrorArchive'/>
    <appendCSV item='UseRemoteArchive'/>
    <appendCSV item='UseHeaders'/>
    <appendCSV item='PhysicalErrorArchiveDirectory'/>
    <appendCSV item='MinimumAge'/>
    <appendCSV item='Recursive'/>
    <appendCSV item='PollingFrequency'/>
    <appendCSV item='DeleteFile'/>
    <appendCSV item='IncludeFiles'/>
    <!-- File/FTP Move -->
    <appendCSV item='SourcePhysicalDirectory'/>
    <appendCSV item='SourceFileName'/>
    <appendCSV item='SourceIsRemote'/>
    <appendCSV item='TargetPhysicalDirectory'/>
    <appendCSV item='TargetFileName'/>
    <appendCSV item='Type'/>
    <!-- Database -->
    <appendCSV item='SchemaName'/>
    <appendCSV item='PackageName'/>
    <appendCSV item='ProcedureName'/>
    <appendCSV item='GetActiveUnitOfWork'/>
    <appendCSV item='DescriptorName'/>
    <appendCSV item='DmlType'/>
    <appendCSV item='MappingsMetaDataURL'/>
    <appendCSV item='DetectOmissions'/>
    <appendCSV item='SqlString'/>
    <appendCSV item='QueryName'/>
    <appendCSV item='PollingStrategy'/>
    <appendCSV item='PollingInterval'/>
    <appendCSV item='MaxRaiseSize'/>
    <appendCSV item='MaxTransactionSize'/>
    <appendCSV item='NumberOfThreads'/>
    <appendCSV item='ReturnSingleResultSet'/>
    <echo file="${outputFile}" append="true" message="${line.separator}"></echo>
    <foreach param="project.file" target="handleProject" delimiter=';' inheritall="true">
      <path>
        <fileset id="dist.contents" dir="${svnRoot}" includes="**/*.jpr"/>
      </path>
    </foreach>
  </target>
  <target name="handleProject">
    <echo message="projectFile: ${project.file}"></echo>
    <dirname property="project.dir" file="${project.file}"/>
    <echo message="project dir: ${project.dir}"></echo>
    <property name="application.dir" location="${project.dir}/.."/>
    <basename property="application.name" file="${application.dir}"/>
    <basename property="project.name" file="${project.file}" suffix=".jpr"/>
    <foreach param="jca.file" target="handleJca" delimiter=";" inheritall="true">
      <path>
        <fileset id="dist.contents" dir="${project.dir}" includes="**/*.jca"/>
      </path>
    </foreach>
  </target>
  <target name="handleJca">
    <basename property="jca.file.name" file="${jca.file}"/>
    <property name="jca.file.props" value="${jcaTempDir}/${jca.file.name}.props"/>
    <echo message="Jca File: ${jca.file.name}"></echo>
    <xslt style="${jcaPropsXsl}" in="${jca.file}" out="${jca.file.props}"/>
    <xmlproperty file="${jca.file.props}" collapseattributes="true"/>
    <!-- see https://ant.apache.org/manual/Tasks/xmlproperty.html -->
    <appendCSV item="${application.name}" first="true"/>
    <appendCSV item="${project.name}"/>
    <appendCSV item="${jca.file.name}"/>
    <appendCSV item="${adapter-config.name}"/>
    <appendCSV item="${adapter-config.adapter}"/>
    <appendCSV item="${adapter-config.endpoint.spec.type}"/>
    <appendCSV item="${adapter-config.connection-factory.location}"/>
    <appendCSV item="${adapter-config.endpoint.portType}"/>
    <appendCSV item="${adapter-config.endpoint.operation}"/>
    <appendCSV item="${adapter-config.endpoint.spec.className}"/>
    <!--JMS/AQ -->
    <appendCSV item="${adapter-config.endpoint.spec.DestinationName}"/>
    <appendCSV item="${adapter-config.endpoint.spec.QueueName}"/>
    <appendCSV item="${adapter-config.endpoint.spec.DeliveryMode}"/>
    <appendCSV item="${adapter-config.endpoint.spec.TimeToLive}"/>
    <appendCSV item="${adapter-config.endpoint.spec.UseMessageListener}"/>
    <appendCSV item="${adapter-config.endpoint.spec.MessageSelector}"/>
    <appendCSV item="${adapter-config.endpoint.spec.PayloadType}"/>
    <appendCSV item="${adapter-config.endpoint.spec.ObjectFieldName}"/>
    <appendCSV item="${adapter-config.endpoint.spec.PayloadHeaderRequired}"/>
    <appendCSV item="${adapter-config.endpoint.spec.RecipientList}"/>
    <appendCSV item="${adapter-config.endpoint.spec.Consumer}"/>
    <!--File/FTP -->
    <appendCSV item="${adapter-config.endpoint.spec.ChunkSize}"/>
    <appendCSV item="${adapter-config.endpoint.spec.NumberMessages}"/>
    <appendCSV item="${adapter-config.endpoint.spec.Append}"/>
    <appendCSV item="${adapter-config.endpoint.spec.FileName}"/>
    <appendCSV item="${adapter-config.endpoint.spec.FileType}"/>
    <appendCSV item="${adapter-config.endpoint.spec.FileNamingConvention}"/>
    <appendCSV item="${adapter-config.endpoint.spec.LogicalDirectory}"/>
    <appendCSV item="${adapter-config.endpoint.spec.LogicalArchiveDirectory}"/>
    <appendCSV item="${adapter-config.endpoint.spec.UseRemoteErrorArchive}"/>
    <appendCSV item="${adapter-config.endpoint.spec.UseRemoteArchive}"/>
    <appendCSV item="${adapter-config.endpoint.spec.UseHeaders}"/>
    <appendCSV item="${adapter-config.endpoint.spec.PhysicalErrorArchiveDirectory}"/>
    <appendCSV item="${adapter-config.endpoint.spec.MinimumAge}"/>
    <appendCSV item="${adapter-config.endpoint.spec.Recursive}"/>
    <appendCSV item="${adapter-config.endpoint.spec.PollingFrequency}"/>
    <appendCSV item="${adapter-config.endpoint.spec.DeleteFile}"/>
    <appendCSV item="${adapter-config.endpoint.spec.IncludeFiles}"/>
    <!-- File/FTP Move -->
    <appendCSV item="${adapter-config.endpoint.spec.SourcePhysicalDirectory}"/>
    <appendCSV item="${adapter-config.endpoint.spec.SourceFileName}"/>
    <appendCSV item="${adapter-config.endpoint.spec.SourceIsRemote}"/>
    <appendCSV item="${adapter-config.endpoint.spec.TargetPhysicalDirectory}"/>
    <appendCSV item="${adapter-config.endpoint.spec.TargetFileName}"/>
    <appendCSV item="${adapter-config.endpoint.spec.Type}"/>
    <!-- Database -->
    <appendCSV item="${adapter-config.endpoint.spec.SchemaName}"/>
    <appendCSV item="${adapter-config.endpoint.spec.PackageName}"/>
    <appendCSV item="${adapter-config.endpoint.spec.ProcedureName}"/>
    <appendCSV item="${adapter-config.endpoint.spec.GetActiveUnitOfWork}"/>
    <appendCSV item="${adapter-config.endpoint.spec.DescriptorName}"/>
    <appendCSV item="${adapter-config.endpoint.spec.DmlType}"/>
    <appendCSV item="${adapter-config.endpoint.spec.MappingsMetaDataURL}"/>
    <appendCSV item="${adapter-config.endpoint.spec.DetectOmissions}"/>
    <appendCSV item='"${adapter-config.endpoint.spec.SqlString}"'/>
    <appendCSV item="${adapter-config.endpoint.spec.QueryName}"/>
    <appendCSV item="${adapter-config.endpoint.spec.PollingStrategy}"/>
    <appendCSV item="${adapter-config.endpoint.spec.PollingInterval}"/>
    <appendCSV item="${adapter-config.endpoint.spec.MaxRaiseSize}"/>
    <appendCSV item="${adapter-config.endpoint.spec.MaxTransactionSize}"/>
    <appendCSV item="${adapter-config.endpoint.spec.NumberOfThreads}"/>
    <appendCSV item="${adapter-config.endpoint.spec.ReturnSingleResultSet}"/>
    <echo file="${outputFile}" append="true" message="${line.separator}"></echo>
  </target>
  <macrodef name="appendCSV">
    <attribute name="item"/>
    <attribute name="first" default="false"/>
    <sequential>
      <if>
        <equals arg1="@{first}" arg2="true"/>
        <then>
          <echo file="${outputFile}" append="true" message="@{item}"></echo>
        </then>
        <else>
          <echo file="${outputFile}" append="true" message=",@{item}"></echo>
        </else>
      </if>
    </sequential>
  </macrodef>
</project>